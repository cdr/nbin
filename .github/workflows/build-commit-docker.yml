name: Build Docker images
on:
  push:
    branches:
       - 'sr229/docker-xbuild'
       - 'master'

jobs:
  build_arm:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master

      - name: Install Docker Edge Build (for Xbuild commands)
        command: wget -qO - https://test.docker.com | sh
      
      - name: Setup Builder instance
        command: |
            docker buildx create --name cdr-build
            docker buildx use cdr-build
            docker buildx inspect --bootstrap
      
      - name: Build Images - ARM (CentOS)
        command: |
           docker buildx build --platform linux/arm -t codercom/nbin-centos:arm -f centos.dockerfile
           docker buildx build --platform linux/arm64 -t codercom/nbin-centos:arm64 -f centos.dockerfile
      
      - name: Build Images - ARM (Alpine)
        command: |
           docker buildx build --platform linux/arm -t codercom/nbin-alpine:arm -f alpine.dockerfile
           docker buildx build --platform linux/arm64 -t codercom/nbin-alpine:arm64 -f alpine.dockerfile

      - name: Build Images - AMD64 (CentOS)
        command: docker buildx build --platform linux/amd64 -t codercom/nbin-centos:amd64 -f centos.dockerfile
      
      - name: Build Images - AMD64 (Alpine)
        command: docker buildx build --platform linux/amd64 -t codercom/nbin-alpine:amd64 -f alpine.dockerfile

  build_amd64:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master

      - name: Install Docker Edge Build (for Xbuild commands)
        command: wget -qO - https://test.docker.com | sh
      
      - name: Setup Builder instance
        command: |
            docker buildx create --name cdr-build
            docker buildx use cdr-build
            docker buildx inspect --bootstrap

      - name: Build Images - AMD64 (CentOS)
        command: docker buildx build --platform linux/amd64 -t codercom/nbin-centos:amd64 -f centos.dockerfile
      
      - name: Build Images - AMD64 (Alpine)
        command: docker buildx build --platform linux/amd64 -t codercom/nbin-alpine:amd64 -f alpine.dockerfile